<div class="documents-page">
  <div class="page-container">
    <header class="page-header">
      <div class="header-content">
        <div class="header-info">
          <h1>Visor de Documentos Electrónicos</h1>
          <p class="subtitle">Visualiza y descarga tus comprobantes en formato PDF, XML o CDR</p>
        </div>
        <button class="btn-logout" type="button" (click)="ctrl.logout()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M13 3H16C16.5304 3 17.0391 3.21071 17.4142 3.58579C17.7893 3.96086 18 4.46957 18 5V15C18 15.5304 17.7893 16.0391 17.4142 16.4142C17.0391 16.7893 16.5304 17 16 17H13M7 13L3 9M3 9L7 5M3 9H13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Cerrar sesión
        </button>
      </div>
    </header>

    <div class="controls-bar">
      <div class="ticket-input-group">
        <label class="input-label">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
            <path d="M9 2C8.44772 2 8 2.44772 8 3C8 3.55228 8.44772 4 9 4H11C11.5523 4 12 3.55228 12 3C12 2.44772 11.5523 2 11 2H9Z" fill="#4F46E5"/>
            <path d="M4 5C4 3.89543 4.89543 3 6 3C6 4.65685 7.34315 6 9 6H11C12.6569 6 14 4.65685 14 3C15.1046 3 16 3.89543 16 5V16C16 17.1046 15.1046 18 14 18H6C4.89543 18 4 17.1046 4 16V5Z" fill="#4F46E5"/>
          </svg>
          Ticket del documento
        </label>
        <div class="input-with-button">
          <input
            class="ticket-input"
            type="text"
            [ngModel]="ctrl.ticket()"
            (ngModelChange)="ctrl.ticket.set($event)"
            (keyup.enter)="ctrl.loadCurrent()"
            placeholder="Ej: 571cc3a3-5b1f-4855-af26-0de6e7c5475f"
          />
          <button 
            class="btn-search" 
            type="button" 
            (click)="ctrl.loadCurrent()" 
            [disabled]="ctrl.loading()"
          >
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
              <path d="M9 2C5.13401 2 2 5.13401 2 9C2 12.866 5.13401 16 9 16C10.8859 16 12.5977 15.2542 13.8564 14.0414L16.2929 16.4779C16.6834 16.8684 17.3166 16.8684 17.7071 16.4779C18.0976 16.0874 18.0976 15.4542 17.7071 15.0637L15.2706 12.6272C16.4834 11.3685 17.2292 9.65669 17.2292 7.77083C17.2292 3.90484 14.0952 0.770833 10.2292 0.770833" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Buscar
          </button>
        </div>
      </div>

      <div class="type-selector">
        <label class="selector-label">Tipo de archivo:</label>
        <div class="type-buttons">
          <button
            class="type-btn"
            [class.active]="ctrl.selectedKind() === 'pdf'"
            (click)="ctrl.select('pdf')"
            type="button"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2Z" fill="currentColor" opacity="0.2"/>
              <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            PDF
          </button>
          <button
            class="type-btn"
            [class.active]="ctrl.selectedKind() === 'xml'"
            (click)="ctrl.select('xml')"
            type="button"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" fill="currentColor" opacity="0.2"/>
              <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="currentColor" stroke-width="2"/>
            </svg>
            XML
          </button>
          <button
            class="type-btn"
            [class.active]="ctrl.selectedKind() === 'cdr'"
            (click)="ctrl.select('cdr')"
            type="button"
          >
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" fill="currentColor" opacity="0.2"/>
              <path d="M9 12L11 14L15 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            CDR
          </button>
        </div>
      </div>
    </div>

    <div class="alert-error" *ngIf="ctrl.error()">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
        <circle cx="10" cy="10" r="8" fill="#FEF2F2"/>
        <path d="M10 6V11M10 14H10.01" stroke="#DC2626" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <p>{{ ctrl.error() }}</p>
    </div>

    <div class="viewer-container">
      <div class="viewer-header">
        <div class="header-left">
          <h3>Vista previa</h3>
          <span class="badge" *ngIf="ctrl.selectedKind()">
            {{ ctrl.selectedKind().toUpperCase() }}
          </span>
        </div>
        <div class="header-right">
          <div class="loading-indicator" *ngIf="ctrl.loading()">
            <svg class="spinner" width="20" height="20" viewBox="0 0 20 20">
              <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="2" fill="none" opacity="0.25"/>
              <path d="M10 2C5.58 2 2 5.58 2 10" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
            </svg>
            <span>Cargando...</span>
          </div>
          <a class="btn-download" *ngIf="ctrl.downloadUrl()" [href]="ctrl.downloadUrl()" download>
            <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
              <path d="M10 3V13M10 13L6 9M10 13L14 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 17H17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Descargar
          </a>
        </div>
      </div>

      <div class="viewer-content">
        <ng-container [ngSwitch]="ctrl.selectedKind()">
          <ng-container *ngSwitchCase="'pdf'">
            <ng-container *ngIf="ctrl.safeUrl(); else pdfEmpty">
              <iframe class="pdf-iframe" [src]="ctrl.safeUrl()" title="Visor PDF"></iframe>
            </ng-container>
            <ng-template #pdfEmpty>
              <div class="empty-state">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                  <rect x="20" y="10" width="40" height="60" rx="4" fill="#E5E7EB"/>
                  <path d="M30 30H50M30 40H50M30 50H40" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <p>Selecciona o ingresa un ticket para visualizar el documento</p>
              </div>
            </ng-template>
          </ng-container>

          <ng-container *ngSwitchCase="'xml'">
            <div class="xml-viewer" *ngIf="ctrl.xmlText(); else xmlEmpty">
              <pre class="xml-code">{{ ctrl.xmlText() }}</pre>
            </div>
            <ng-template #xmlEmpty>
              <div class="empty-state">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                  <path d="M25 20L15 40L25 60M55 20L65 40L55 60M45 15L35 65" stroke="#9CA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p>El contenido XML se mostrará aquí</p>
              </div>
            </ng-template>
          </ng-container>

          <ng-container *ngSwitchCase="'cdr'">
            <div class="xml-viewer" *ngIf="ctrl.xmlText(); else cdrEmpty">
              <pre class="xml-code">{{ ctrl.xmlText() }}</pre>
            </div>
            <ng-template #cdrEmpty>
              <div class="empty-state">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                  <circle cx="40" cy="40" r="30" stroke="#9CA3AF" stroke-width="2" fill="#E5E7EB"/>
                  <path d="M30 40L37 47L52 32" stroke="#4F46E5" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <p>El contenido CDR se mostrará aquí</p>
              </div>
            </ng-template>
          </ng-container>
        </ng-container>
      </div>
    </div>
  </div>
</div>
